!function(e,t){"use strict";t.module("satellizer",[]).constant("satellizer.config",{logoutRedirect:"/",loginRedirect:"/",signupRedirect:"/login",loginUrl:"/auth/login",signupUrl:"/auth/signup",loginRoute:"/login",signupRoute:"/signup",tokenName:"token",tokenPrefix:"satellizer",unlinkUrl:"/auth/unlink/",providers:{google:{url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:e.location.origin,scope:"openid profile email",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:452,height:633}},facebook:{url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/dialog/oauth",redirectUri:e.location.origin+"/",scope:"email",scopeDelimiter:",",requiredUrlParams:["display","scope"],display:"popup",type:"2.0",popupOptions:{width:481,height:269}},linkedin:{url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:e.location.origin,requiredUrlParams:["state"],scope:[],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:e.location.origin,scope:[],scopeDelimiter:" ",type:"2.0",popupOptions:{width:1020,height:618}},twitter:{url:"/auth/twitter",type:"1.0"}}}).provider("$auth",["satellizer.config",function(e){Object.defineProperties(this,{logoutRedirect:{get:function(){return e.logoutRedirect},set:function(t){e.logoutRedirect=t}},loginRedirect:{set:function(t){e.loginRedirect=t},get:function(){return e.loginRedirect}},signupRedirect:{get:function(){return e.signupRedirect},set:function(t){e.signupRedirect=t}},loginUrl:{get:function(){return e.loginUrl},set:function(t){e.loginUrl=t}},signupUrl:{get:function(){return e.signupUrl},set:function(t){e.signupUrl=t}},loginRoute:{get:function(){return e.loginRoute},set:function(t){e.loginRoute=t}},signupRoute:{get:function(){return e.signupRoute},set:function(t){e.signupRoute=t}},tokenName:{get:function(){return e.tokenName},set:function(t){e.tokenName=t}},tokenPrefix:{get:function(){return e.tokenPrefix},set:function(t){e.tokenPrefix=t}},unlinkUrl:{get:function(){return e.unlinkUrl},set:function(t){e.unlinkUrl=t}}}),this.facebook=function(n){t.extend(e.providers.facebook,n)},this.google=function(n){t.extend(e.providers.google,n)},this.linkedin=function(n){t.extend(e.providers.linkedin,n)},this.github=function(n){t.extend(e.providers.github,n)},this.twitter=function(n){t.extend(e.providers.twitter,n)};var n=function(n){e.providers[n.name]=e.providers[n.name]||{},t.extend(e.providers[n.name],n)};this.oauth1=function(t){n(t),e.providers[t.name].type="1.0"},this.oauth2=function(t){n(t),e.providers[t.name].type="2.0"},this.$get=["$q","$http","$rootScope","satellizer.local","satellizer.utils","satellizer.Oauth1","satellizer.Oauth2",function(t,n,o,i,r,u,a){var c={};return c.authenticate=function(n){var o=t.defer(),r="1.0"===e.providers[n].type?new u:new a;return r.open(e.providers[n]).then(function(t){i.parseUser(t.data[e.tokenName],o)}).catch(function(e){o.reject(e)}),o.promise},c.login=function(e){return i.login(e)},c.signup=function(e){return i.signup(e)},c.logout=function(){return i.logout()},c.isAuthenticated=function(){return i.isAuthenticated()},c.link=function(e){return c.authenticate(e)},c.unlink=function(e){return i.unlink(e)},c.updateToken=function(t){localStorage.setItem([e.tokenPrefix,e.tokenName].join("_"),t)},c}]}]).factory("satellizer.local",["$q","$http","$location","$rootScope","satellizer.utils","satellizer.config",function(e,t,n,o,i,r){var u={};return u.parseUser=function(e,t){localStorage.setItem([r.tokenPrefix,r.tokenName].join("_"),e),o.isAuthenticated=!0,r.loginRedirect&&n.path(r.loginRedirect),t.resolve()},u.login=function(n){var o=e.defer();return t.post(r.loginUrl,n).then(function(e){u.parseUser(e.data[r.tokenName],o)}).catch(function(e){o.reject(e)}),o.promise},u.signup=function(o){var i=e.defer();return t.post(r.signupUrl,o).then(function(){n.path(r.signupRedirect),i.resolve()}).catch(function(e){i.reject(e)}),i.promise},u.logout=function(){var t=e.defer();return o.isAuthenticated=!1,localStorage.removeItem([r.tokenPrefix,r.tokenName].join("_")),r.logoutRedirect&&n.path(r.logoutRedirect),t.resolve(),t.promise},u.isAuthenticated=function(){return o.isAuthenticated},u.unlink=function(n){var o=e.defer();return t.get(r.unlinkUrl+n).then(function(e){u.parseUser(e.data[r.tokenName],o)}).catch(function(e){o.reject(e)}),o.promise},u}]).factory("satellizer.Oauth2",["$q","$http","satellizer.popup","satellizer.utils",function(e,n,o,i){return function(){function r(n){t.extend(l,n);var i=e.defer(),r=a();return o.open(r,l.popupOptions).then(function(e){u(e).then(function(e){i.resolve(e)}).catch(function(e){i.reject(e)})}).catch(function(e){i.reject(e)}),i.promise}function u(e){return n.post(l.url,{code:e.code,clientId:l.clientId,redirectUri:l.redirectUri})}function a(){var e=l.authorizationEndpoint,t=c();return[e,t].join("?")}function c(){var e=[],n=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return t.forEach(n,function(n){t.forEach(l[n],function(t){var n=i.camelCase(t),o=l[n];e.push([t,encodeURIComponent(o)])})}),e.map(function(e){return e.join("=")}).join("&")}var l={url:null,name:null,scope:null,scopeDelimiter:null,clientId:null,redirectUri:null,popupOptions:null,authorizationEndpoint:null,requiredUrlParams:null,optionalUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code"};return{open:r,exchangeForToken:u,buildUrl:a,buildQueryString:c}}}]).factory("satellizer.Oauth1",["$q","$http","satellizer.popup",function(e,n,o){return function(){function i(n){t.extend(a,n);var i=e.defer();return o.open(a.url).then(function(e){r(e).then(function(e){i.resolve(e)}).catch(function(e){i.reject(e)})}).catch(function(e){i.reject(e)}),i.promise}function r(e){return e=u(e),n.get(a.url+"?"+e)}function u(e){var n=[];return t.forEach(e,function(e,t){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),n.join("&")}var a={url:null,name:null,popupOptions:null};return{open:i,exchangeForToken:r,buildQueryString:u}}}]).factory("satellizer.popup",["$q","$interval","$window",function(e,n,o){var i=null,r=null,u={};return u.popupWindow=i,u.open=function(t,n){var r=e.defer(),a=u.stringifyOptions(u.prepareOptions(n||{}));return i=o.open(t,"_blank",a),i.focus(),u.postMessageHandler(r),u.pollPopup(r),r.promise},u.pollPopup=function(e){r=n(function(){i.closed&&(n.cancel(r),e.reject({data:"Authorization Failed"}))},35)},u.postMessageHandler=function(e){o.addEventListener("message",function(t){t.origin===o.location.origin&&(i.close(),t.data.error?e.reject({data:t.data.error}):e.resolve(t.data))},!1)},u.prepareOptions=function(e){var n=e.width||500,i=e.height||500;return t.extend({width:n,height:i,left:o.screenX+(o.outerWidth-n)/2,top:o.screenY+(o.outerHeight-i)/2.5},e)},u.stringifyOptions=function(e){var n=[];return t.forEach(e,function(e,t){n.push(t+"="+e)}),n.join(",")},u}]).service("satellizer.utils",function(){this.camelCase=function(e){return e.replace(/([\:\-\_]+(.))/g,function(e,t,n,o){return o?n.toUpperCase():n})},this.parseQueryString=function(e){var n,o,i={};return t.forEach((e||"").split("&"),function(e){e&&(o=e.split("="),n=decodeURIComponent(o[0]),i[n]=t.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),i}}).config(["$httpProvider","satellizer.config",function(e,t){e.interceptors.push(["$q",function(e){return{request:function(e){return localStorage.getItem([t.tokenPrefix,t.tokenName].join("_"))&&(e.headers.Authorization="Bearer "+localStorage.getItem([t.tokenPrefix,t.tokenName].join("_"))),e},responseError:function(n){return 401===n.status&&localStorage.removeItem([t.tokenPrefix,t.tokenName].join("_")),e.reject(n)}}}])}]).run(["$rootScope","$window","$location","satellizer.utils","satellizer.config",function(e,n,o,i,r){var u=localStorage.getItem([r.tokenPrefix,r.tokenName].join("_"));u&&(e.isAuthenticated=!0);var a=n.location.search.substring(1),c=Object.keys(o.search()).length?o.search():i.parseQueryString(a);n.opener&&n.opener.location.origin===n.location.origin&&(c.oauth_token&&c.oauth_verifier?n.opener.postMessage({oauth_token:c.oauth_token,oauth_verifier:c.oauth_verifier},n.location.origin):c.code?n.opener.postMessage({code:c.code},n.location.origin):c.error&&n.opener.postMessage({error:c.error},n.location.origin));try{t.module("ngRoute"),e.$on("$routeChangeStart",function(t,n){!e.isAuthenticated||n.originalPath!==r.loginRoute&&n.originalPath!==r.signupRoute||o.path(r.loginRedirect),n.protected&&!e.isAuthenticated&&o.path(r.loginRoute)})}catch(l){}try{t.module("ui.router"),e.$on("$stateChangeStart",function(t,n){!e.isAuthenticated||n.url!==r.loginRoute&&n.url!==r.signupRoute||o.path(r.loginRedirect),n.protected&&!e.isAuthenticated&&o.path(r.loginRoute)})}catch(l){}}])}(window,window.angular);